---
import FloatingWhatsApp from '../components/FloatingWhatsApp.astro';
export interface Props {
  title: string;
  description?: string;
  image?: string;
  keywords?: string;
}

const {
  title,
  description = 'Serasi Parket - Supplier parquet kayu premium Indonesia. Jati, Ulin, Merbau, dan kayu berkualitas tinggi untuk flooring, dinding, dan aplikasi custom.',
  image = '/images/serasi-parket-og.jpg',
  keywords = 'parquet kayu, flooring kayu, kayu jati, kayu ulin, kayu merbau, supplier kayu Indonesia',
} = Astro.props;

const canonicalURL = new URL(Astro.url.pathname, Astro.site);
---

<!doctype html>
<html lang="id" class="scroll-smooth">
  <head>
    <meta charset="UTF-8" />
    <meta name="description" content={description} />
    <meta name="keywords" content={keywords} />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <meta name="generator" content={Astro.generator} />
    <title>{title}</title>
    <link rel="canonical" href={canonicalURL} />

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website" />
    <meta property="og:url" content={canonicalURL} />
    <meta property="og:title" content={title} />
    <meta property="og:description" content={description} />
    <meta property="og:image" content={new URL(image, Astro.site)} />
    <meta property="og:locale" content="id_ID" />
    <meta property="og:site_name" content="Serasi Parket" />

    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image" />
    <meta property="twitter:url" content={canonicalURL} />
    <meta property="twitter:title" content={title} />
    <meta property="twitter:description" content={description} />
    <meta property="twitter:image" content={new URL(image, Astro.site)} />

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Playfair+Display:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />

    <!-- Schema.org JSON-LD -->
    <script type="application/ld+json" is:inline>
      {
        "@context": "https://schema.org",
        "@type": "Organization",
        "name": "Serasi Parket",
        "url": "https://serasi-parket.com",
        "logo": "https://serasi-parket.com/images/logo.png",
        "description": "Supplier parquet kayu premium Indonesia dengan kualitas terbaik dan layanan profesional",
        "address": {
          "@type": "PostalAddress",
          "streetAddress": "Jl. Industri Kayu No. 123",
          "addressLocality": "Jakarta",
          "addressRegion": "DKI Jakarta",
          "postalCode": "10120",
          "addressCountry": "ID"
        },
        "contactPoint": {
          "@type": "ContactPoint",
          "telephone": "+62-21-1234-5678",
          "contactType": "customer service",
          "availableLanguage": ["Indonesian", "English"]
        },
        "sameAs": [
          "https://www.facebook.com/serasiparket",
          "https://www.instagram.com/serasiparket",
          "https://www.linkedin.com/company/serasiparket"
        ]
      }
    </script>

    <!-- Global Styles -->
    <style is:global>
      @import '../styles/global.css';
    </style>

    <!-- Google Analytics 4 -->
    <script
      async
      src="https://www.googletagmanager.com/gtag/js?id=GA_MEASUREMENT_ID"
      is:inline></script>
    <script is:inline>
      window.dataLayer = window.dataLayer || [];
      function gtag() {
        dataLayer.push(arguments);
      }
      gtag('js', new Date());
      gtag('config', 'GA_MEASUREMENT_ID', {
        page_title: document.title,
        page_location: window.location.href,
        content_group1: 'Wood Products',
        custom_map: {
          custom_parameter_1: 'page_category',
        },
      });
    </script>
  </head>
  <body class="font-body text-gray-900 bg-wood-light">
    <slot />

    <FloatingWhatsApp />

    <!-- Newsletter Popup -->
    <div
      id="newsletter-popup"
      class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden items-center justify-center p-4 no-print"
    >
      <div class="bg-white rounded-lg max-w-md w-full p-6 relative">
        <button
          id="close-popup"
          class="absolute top-4 right-4 text-gray-500 hover:text-gray-700"
        >
          <svg
            class="w-6 h-6"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M6 18L18 6M6 6l12 12"></path>
          </svg>
        </button>

        <div class="text-center mb-4">
          <h3 class="text-2xl font-display font-semibold text-gray-900 mb-2">
            Dapatkan Tips Perawatan Kayu
          </h3>
          <p class="text-gray-600">
            Berlangganan newsletter kami untuk mendapatkan tips perawatan kayu
            dan update produk terbaru.
          </p>
        </div>

        <form id="newsletter-form" class="space-y-4">
          <input
            type="email"
            name="email"
            placeholder="Masukkan email Anda"
            required
            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent"
          />
          <button
            type="submit"
            class="w-full bg-primary-600 text-white py-2 px-4 rounded-lg hover:bg-primary-700 transition-colors duration-300"
          >
            Berlangganan
          </button>
        </form>
      </div>
    </div>

    <script is:inline>
      // Newsletter popup functionality
      function showNewsletterPopup() {
        const popup = document.getElementById('newsletter-popup');
        if (popup && !localStorage.getItem('newsletter-shown')) {
          setTimeout(() => {
            popup.classList.remove('hidden');
            popup.classList.add('flex');
          }, 10000);
        }
      }

      // Close popup functionality
      const closePopupBtn = document.getElementById('close-popup');
      if (closePopupBtn) {
        closePopupBtn.addEventListener('click', function () {
          const popup = document.getElementById('newsletter-popup');
          if (popup) {
            popup.classList.add('hidden');
            popup.classList.remove('flex');
            localStorage.setItem('newsletter-shown', 'true');
          }
        });
      }

      // Newsletter form submission
      const newsletterForm = document.getElementById('newsletter-form');
      if (newsletterForm) {
        newsletterForm.addEventListener('submit', function (e) {
          e.preventDefault();
          const email = this.email.value;

          // Track newsletter signup
          if (typeof gtag !== 'undefined') {
            gtag('event', 'newsletter_signup', {
              method: 'popup',
              email: email,
            });
          }

          alert(
            'Terima kasih! Anda akan segera mendapatkan tips perawatan kayu dari kami.'
          );

          const popup = document.getElementById('newsletter-popup');
          if (popup) {
            popup.classList.add('hidden');
            popup.classList.remove('flex');
            localStorage.setItem('newsletter-shown', 'true');
          }
        });
      }

      // Show popup on page load
      document.addEventListener('DOMContentLoaded', showNewsletterPopup);

      // Track scroll depth
      let maxScroll = 0;
      window.addEventListener('scroll', function () {
        const currentScroll = Math.round(
          (window.scrollY / (document.body.scrollHeight - window.innerHeight)) *
            100
        );
        if (currentScroll > maxScroll) {
          maxScroll = currentScroll;
          if (typeof gtag !== 'undefined') {
            if (maxScroll >= 25 && maxScroll < 50) {
              gtag('event', 'scroll', { scroll_depth: 25 });
            } else if (maxScroll >= 50 && maxScroll < 75) {
              gtag('event', 'scroll', { scroll_depth: 50 });
            } else if (maxScroll >= 75 && maxScroll < 90) {
              gtag('event', 'scroll', { scroll_depth: 75 });
            } else if (maxScroll >= 90) {
              gtag('event', 'scroll', { scroll_depth: 90 });
            }
          }
        }
      });
    </script>
  </body>
</html>
